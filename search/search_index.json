{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Tusk Framework","text":"<p>Domain-first PHP Application Framework</p> <p>Tusk is a modern, lightweight PHP framework designed for building high-performance web applications and microservices. Built with PHP 8.2+, it emphasizes clean architecture, developer experience, and production readiness.</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Native Go Engine: Replaces Nginx and PHP-FPM with a single, high-performance Go binary.</li> <li>Unified CLI: One tool (<code>tusk</code>) for server management, scaffolding, and custom scripts.</li> <li>Persistent Runtime: Applications stay in memory, drastically reducing latency.</li> <li>Sidecar PHP: Automatic management of a portable PHP runtime for zero-dependency deployment.</li> <li>Domain-First Framework: Clean architecture patterns (DI, Repository, Events) built for performance.</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code># Install Tusk globally\ncurl -sSL https://tusk.sh/install.sh | bash\n\n# Create a project\ntusk init my-app\n\n# Start the runtime\ncd my-app\ntusk start\n</code></pre> <p>Visit <code>http://localhost:8080</code> to see your app running!</p>"},{"location":"#philosophy","title":"Philosophy","text":"<p>Tusk follows these core principles:</p> <ol> <li>Domain-First: Your business logic comes first, not the framework</li> <li>Explicit over Magic: Clear, readable code over hidden conventions</li> <li>Performance: Native implementations, minimal overhead</li> <li>Developer Experience: Fast scaffolding, clear errors, great tooling</li> </ol>"},{"location":"#components","title":"Components","text":"<ul> <li>tusk/core: Dependency injection and kernel contracts</li> <li>tusk/runtime: Process manager and supervisor</li> <li>tusk/web: HTTP server, router, and request handling</li> <li>tusk/data: Database abstraction and repository pattern</li> <li>tusk/micro: Microservice utilities (health, metrics, RPC)</li> <li>tusk/cli: Command-line tools and scaffolding</li> </ul>"},{"location":"#community","title":"Community","text":"<ul> <li>GitHub</li> <li>Issues</li> <li>Discussions</li> </ul>"},{"location":"#license","title":"License","text":"<p>MIT License - see LICENSE</p>"},{"location":"api/container/","title":"Container API Reference","text":"<p>The <code>Container</code> class is the heart of Tusk's dependency injection system.</p>"},{"location":"api/container/#class-tuskcorecontainercontainer","title":"Class: <code>Tusk\\Core\\Container\\Container</code>","text":""},{"location":"api/container/#methods","title":"Methods","text":""},{"location":"api/container/#setstring-id-callable-factory-void","title":"<code>set(string $id, callable $factory): void</code>","text":"<p>Register a service factory in the container.</p> <p>Parameters: - <code>$id</code> (string) - Service identifier (typically the class name) - <code>$factory</code> (callable) - Factory function that returns the service instance</p> <p>Example:</p> <pre><code>use Tusk\\Core\\Container\\Container;\n\n$container = new Container();\n\n// Register a simple service\n$container-&gt;set(LoggerInterface::class, function() {\n    return new FileLogger('/var/log/app.log');\n});\n\n// Register with dependencies\n$container-&gt;set(UserService::class, function(Container $c) {\n    return new UserService(\n        $c-&gt;get(UserRepository::class),\n        $c-&gt;get(LoggerInterface::class)\n    );\n});\n</code></pre>"},{"location":"api/container/#getstring-id-mixed","title":"<code>get(string $id): mixed</code>","text":"<p>Resolve and retrieve a service from the container.</p> <p>Parameters: - <code>$id</code> (string) - Service identifier</p> <p>Returns: The resolved service instance</p> <p>Throws: <code>ContainerException</code> if service cannot be resolved</p> <p>Example:</p> <pre><code>$logger = $container-&gt;get(LoggerInterface::class);\n$logger-&gt;info('Application started');\n</code></pre>"},{"location":"api/container/#hasstring-id-bool","title":"<code>has(string $id): bool</code>","text":"<p>Check if a service is registered in the container.</p> <p>Parameters: - <code>$id</code> (string) - Service identifier</p> <p>Returns: <code>true</code> if registered, <code>false</code> otherwise</p> <p>Example:</p> <pre><code>if ($container-&gt;has(CacheInterface::class)) {\n    $cache = $container-&gt;get(CacheInterface::class);\n} else {\n    // Use fallback\n}\n</code></pre>"},{"location":"api/container/#auto-wiring","title":"Auto-Wiring","text":"<p>The container automatically resolves constructor dependencies using reflection.</p> <p>Example:</p> <pre><code>class UserController\n{\n    public function __construct(\n        private UserRepository $repo,\n        private LoggerInterface $logger,\n        private EventDispatcher $events\n    ) {}\n}\n\n// No manual registration needed!\n$controller = $container-&gt;get(UserController::class);\n// Container automatically injects all dependencies\n</code></pre>"},{"location":"api/container/#auto-wiring-rules","title":"Auto-Wiring Rules","text":"<ol> <li>Type-hinted parameters are resolved by their type</li> <li>Interfaces must be explicitly bound to implementations</li> <li>Scalar values cannot be auto-wired (use factory functions)</li> <li>Circular dependencies will throw an exception</li> </ol>"},{"location":"api/container/#singleton-pattern","title":"Singleton Pattern","text":"<p>Register services as singletons to reuse the same instance:</p> <pre><code>$container-&gt;set(DatabaseConnection::class, function() {\n    static $instance = null;\n    if ($instance === null) {\n        $instance = new DatabaseConnection('mysql:host=localhost');\n    }\n    return $instance;\n});\n\n// Or use a helper method (if implemented)\n$container-&gt;singleton(DatabaseConnection::class, function() {\n    return new DatabaseConnection('mysql:host=localhost');\n});\n</code></pre>"},{"location":"api/container/#service-providers","title":"Service Providers","text":"<p>Organize service registration using service providers:</p> <pre><code>use Tusk\\Core\\ServiceProviderInterface;\n\nclass DatabaseServiceProvider implements ServiceProviderInterface\n{\n    public function register(Container $container): void\n    {\n        $container-&gt;set(ConnectionInterface::class, function() {\n            return new PdoConnection(\n                dsn: getenv('DB_DSN'),\n                username: getenv('DB_USER'),\n                password: getenv('DB_PASS')\n            );\n        });\n\n        $container-&gt;set(UserRepository::class, function(Container $c) {\n            return new UserRepository($c-&gt;get(ConnectionInterface::class));\n        });\n    }\n}\n\n// Register the provider\n$provider = new DatabaseServiceProvider();\n$provider-&gt;register($container);\n</code></pre>"},{"location":"api/container/#advanced-patterns","title":"Advanced Patterns","text":""},{"location":"api/container/#factory-pattern","title":"Factory Pattern","text":"<pre><code>$container-&gt;set(EmailServiceFactory::class, function() {\n    return new class {\n        public function create(string $type): EmailServiceInterface {\n            return match($type) {\n                'smtp' =&gt; new SmtpEmailService(),\n                'sendgrid' =&gt; new SendGridEmailService(),\n                default =&gt; throw new \\InvalidArgumentException(\"Unknown type: $type\")\n            };\n        }\n    };\n});\n\n$factory = $container-&gt;get(EmailServiceFactory::class);\n$emailService = $factory-&gt;create('smtp');\n</code></pre>"},{"location":"api/container/#contextual-binding","title":"Contextual Binding","text":"<pre><code>// Different logger for different contexts\n$container-&gt;set(LoggerInterface::class, function(Container $c) {\n    // Default logger\n    return new FileLogger('/var/log/app.log');\n});\n\n$container-&gt;set(AuditService::class, function(Container $c) {\n    // Audit service gets a special logger\n    return new AuditService(\n        new FileLogger('/var/log/audit.log')\n    );\n});\n</code></pre>"},{"location":"api/container/#best-practices","title":"Best Practices","text":"<ol> <li>Bind interfaces, not implementations in your application code</li> <li>Use service providers to organize related services</li> <li>Avoid service locator pattern - inject dependencies via constructor</li> <li>Register services early in your bootstrap process</li> <li>Use singletons sparingly - only for stateless or expensive-to-create services</li> </ol>"},{"location":"api/container/#complete-example","title":"Complete Example","text":"<pre><code>&lt;?php\n// bootstrap.php\n\nuse Tusk\\Core\\Container\\Container;\n\n$container = new Container();\n\n// Configuration\n$container-&gt;set('config', fn() =&gt; require __DIR__ . '/config.php');\n\n// Database\n$container-&gt;set(ConnectionInterface::class, function(Container $c) {\n    $config = $c-&gt;get('config');\n    return new PdoConnection(\n        $config['db']['dsn'],\n        $config['db']['user'],\n        $config['db']['pass']\n    );\n});\n\n// Repositories\n$container-&gt;set(UserRepository::class, function(Container $c) {\n    return new UserRepository($c-&gt;get(ConnectionInterface::class));\n});\n\n// Services\n$container-&gt;set(AuthService::class, function(Container $c) {\n    return new AuthService(\n        $c-&gt;get(UserRepository::class),\n        $c-&gt;get(LoggerInterface::class)\n    );\n});\n\n// Controllers (auto-wired)\n// No need to register - container will auto-wire them!\n\nreturn $container;\n</code></pre>"},{"location":"api/kernel/","title":"Kernel API Reference","text":"<p>The Kernel orchestrates the application lifecycle and manages the runtime environment.</p>"},{"location":"api/kernel/#class-tuskruntimekernel","title":"Class: <code>Tusk\\Runtime\\Kernel</code>","text":""},{"location":"api/kernel/#basic-usage","title":"Basic Usage","text":"<pre><code>use Tusk\\Runtime\\Kernel;\nuse Tusk\\Core\\Container\\Container;\n\n$container = new Container();\n$kernel = new Kernel($container);\n\n// Start the kernel\n$kernel-&gt;start();\n\n// Kernel runs until terminated\n</code></pre>"},{"location":"api/kernel/#lifecycle-methods","title":"Lifecycle Methods","text":""},{"location":"api/kernel/#start-void","title":"<code>start(): void</code>","text":"<p>Starts the kernel and initializes the application.</p> <p>Example:</p> <pre><code>$kernel-&gt;start();\n// Application is now running\n</code></pre>"},{"location":"api/kernel/#stop-void","title":"<code>stop(): void</code>","text":"<p>Gracefully stops the kernel and cleans up resources.</p> <pre><code>// Register shutdown handler\npcntl_signal(SIGTERM, function() use ($kernel) {\n    $kernel-&gt;stop();\n});\n\n$kernel-&gt;start();\n</code></pre>"},{"location":"api/kernel/#restart-void","title":"<code>restart(): void</code>","text":"<p>Restarts the kernel (stops and starts again).</p> <pre><code>$kernel-&gt;restart();\n</code></pre>"},{"location":"api/kernel/#configuration","title":"Configuration","text":""},{"location":"api/kernel/#environment-variables","title":"Environment Variables","text":"<pre><code>// Load environment configuration\n$kernel-&gt;loadEnv(__DIR__ . '/.env');\n\n// Access configuration\n$dbHost = getenv('DB_HOST');\n$appEnv = getenv('APP_ENV') ?: 'production';\n</code></pre>"},{"location":"api/kernel/#service-registration","title":"Service Registration","text":"<pre><code>$kernel-&gt;registerServices([\n    DatabaseServiceProvider::class,\n    CacheServiceProvider::class,\n    LoggingServiceProvider::class,\n]);\n</code></pre>"},{"location":"api/kernel/#event-hooks","title":"Event Hooks","text":""},{"location":"api/kernel/#boot-callbacks","title":"Boot Callbacks","text":"<pre><code>$kernel-&gt;onBoot(function(Container $container) {\n    // Run after kernel boots\n    $logger = $container-&gt;get(LoggerInterface::class);\n    $logger-&gt;info('Application started');\n});\n</code></pre>"},{"location":"api/kernel/#shutdown-callbacks","title":"Shutdown Callbacks","text":"<pre><code>$kernel-&gt;onShutdown(function(Container $container) {\n    // Run before kernel stops\n    $logger = $container-&gt;get(LoggerInterface::class);\n    $logger-&gt;info('Application stopping');\n});\n</code></pre>"},{"location":"api/kernel/#process-management","title":"Process Management","text":""},{"location":"api/kernel/#worker-processes","title":"Worker Processes","text":"<pre><code>use Tusk\\Runtime\\Worker\\WorkerInterface;\n\nclass QueueWorker implements WorkerInterface\n{\n    public function run(): void\n    {\n        while (true) {\n            $job = $this-&gt;queue-&gt;pop();\n            if ($job) {\n                $job-&gt;handle();\n            }\n            usleep(100000); // 100ms\n        }\n    }\n}\n\n// Register worker\n$kernel-&gt;addWorker(new QueueWorker());\n</code></pre>"},{"location":"api/kernel/#supervisor","title":"Supervisor","text":"<pre><code>use Tusk\\Runtime\\Supervisor;\n\n$supervisor = new Supervisor();\n\n// Add workers\n$supervisor-&gt;addWorker(new QueueWorker(), instances: 4);\n$supervisor-&gt;addWorker(new SchedulerWorker(), instances: 1);\n\n// Run supervisor\n$supervisor-&gt;run();\n</code></pre>"},{"location":"api/kernel/#signal-handling","title":"Signal Handling","text":""},{"location":"api/kernel/#graceful-shutdown","title":"Graceful Shutdown","text":"<pre><code>use Tusk\\Runtime\\Kernel;\n\n$kernel = new Kernel($container);\n\n// Handle SIGTERM\npcntl_signal(SIGTERM, function() use ($kernel) {\n    echo \"Received SIGTERM, shutting down gracefully...\\n\";\n    $kernel-&gt;stop();\n    exit(0);\n});\n\n// Handle SIGINT (Ctrl+C)\npcntl_signal(SIGINT, function() use ($kernel) {\n    echo \"Received SIGINT, shutting down...\\n\";\n    $kernel-&gt;stop();\n    exit(0);\n});\n\n$kernel-&gt;start();\n</code></pre>"},{"location":"api/kernel/#reload-configuration","title":"Reload Configuration","text":"<pre><code>pcntl_signal(SIGHUP, function() use ($kernel) {\n    echo \"Received SIGHUP, reloading configuration...\\n\";\n    $kernel-&gt;restart();\n});\n</code></pre>"},{"location":"api/kernel/#complete-application-bootstrap","title":"Complete Application Bootstrap","text":"<pre><code>&lt;?php\n// bootstrap.php\n\nuse Tusk\\Core\\Container\\Container;\nuse Tusk\\Runtime\\Kernel;\nuse Tusk\\Web\\Server\\HttpServer;\n\n// Create container\n$container = new Container();\n\n// Load environment\nif (file_exists(__DIR__ . '/.env')) {\n    $lines = file(__DIR__ . '/.env', FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);\n    foreach ($lines as $line) {\n        if (strpos($line, '=') !== false &amp;&amp; $line[0] !== '#') {\n            putenv($line);\n        }\n    }\n}\n\n// Register services\n$container-&gt;set(ConnectionInterface::class, function() {\n    return new PdoConnection(\n        getenv('DB_DSN'),\n        getenv('DB_USER'),\n        getenv('DB_PASS')\n    );\n});\n\n$container-&gt;set(LoggerInterface::class, function() {\n    return new FileLogger(getenv('LOG_PATH') ?: '/var/log/app.log');\n});\n\n// Create kernel\n$kernel = new Kernel($container);\n\n// Register boot callbacks\n$kernel-&gt;onBoot(function(Container $c) {\n    $logger = $c-&gt;get(LoggerInterface::class);\n    $logger-&gt;info('Application booted', [\n        'env' =&gt; getenv('APP_ENV'),\n        'pid' =&gt; getmypid()\n    ]);\n});\n\n// Register shutdown callbacks\n$kernel-&gt;onShutdown(function(Container $c) {\n    $logger = $c-&gt;get(LoggerInterface::class);\n    $logger-&gt;info('Application shutting down');\n});\n\n// Setup signal handlers\npcntl_signal(SIGTERM, fn() =&gt; $kernel-&gt;stop());\npcntl_signal(SIGINT, fn() =&gt; $kernel-&gt;stop());\n\nreturn $kernel;\n</code></pre>"},{"location":"api/kernel/#http-server-integration","title":"HTTP Server Integration","text":"<pre><code>&lt;?php\n// public/index.php\n\nuse Tusk\\Web\\Server\\HttpServer;\nuse Tusk\\Web\\Router\\Router;\n\n// Bootstrap\n$kernel = require __DIR__ . '/../bootstrap.php';\n$container = $kernel-&gt;getContainer();\n\n// Create router\n$router = new Router($container);\n$router-&gt;registerControllers([\n    \\App\\Controller\\HomeController::class,\n    \\App\\Controller\\UserController::class,\n]);\n\n// Create HTTP server\n$server = new HttpServer('0.0.0.0', 8080, $router);\n\n// Start kernel with HTTP server\n$kernel-&gt;onBoot(function() use ($server) {\n    echo \"HTTP Server listening on http://0.0.0.0:8080\\n\";\n    $server-&gt;start();\n});\n\n$kernel-&gt;start();\n</code></pre>"},{"location":"api/kernel/#testing","title":"Testing","text":""},{"location":"api/kernel/#unit-testing","title":"Unit Testing","text":"<pre><code>use PHPUnit\\Framework\\TestCase;\nuse Tusk\\Core\\Container\\Container;\nuse Tusk\\Runtime\\Kernel;\n\nclass KernelTest extends TestCase\n{\n    public function testKernelBoot(): void\n    {\n        $container = new Container();\n        $kernel = new Kernel($container);\n\n        $booted = false;\n        $kernel-&gt;onBoot(function() use (&amp;$booted) {\n            $booted = true;\n        });\n\n        $kernel-&gt;start();\n\n        $this-&gt;assertTrue($booted);\n    }\n}\n</code></pre>"},{"location":"api/kernel/#best-practices","title":"Best Practices","text":"<ol> <li>Single Kernel Instance - Create only one kernel per application</li> <li>Signal Handlers - Always register SIGTERM/SIGINT handlers for graceful shutdown</li> <li>Environment Variables - Use <code>.env</code> files for configuration</li> <li>Service Providers - Organize service registration in providers</li> <li>Logging - Log kernel lifecycle events for debugging</li> <li>Worker Supervision - Use Supervisor for managing long-running workers</li> </ol>"},{"location":"api/repository/","title":"Repository API Reference","text":"<p>The Repository pattern provides a clean abstraction for data access.</p>"},{"location":"api/repository/#class-tuskdatarepositoryabstractrepository","title":"Class: <code>Tusk\\Data\\Repository\\AbstractRepository</code>","text":""},{"location":"api/repository/#basic-usage","title":"Basic Usage","text":"<pre><code>use Tusk\\Data\\Repository\\AbstractRepository;\nuse Tusk\\Data\\Driver\\ConnectionInterface;\n\nclass UserRepository extends AbstractRepository\n{\n    public function __construct(ConnectionInterface $connection)\n    {\n        parent::__construct($connection);\n    }\n\n    public function findAll(): array\n    {\n        $stmt = $this-&gt;connection-&gt;query('SELECT * FROM users');\n        return $stmt-&gt;fetchAll(\\PDO::FETCH_ASSOC);\n    }\n\n    public function findById(int $id): ?array\n    {\n        $stmt = $this-&gt;connection-&gt;prepare('SELECT * FROM users WHERE id = ?');\n        $stmt-&gt;execute([$id]);\n        return $stmt-&gt;fetch(\\PDO::FETCH_ASSOC) ?: null;\n    }\n}\n</code></pre>"},{"location":"api/repository/#crud-operations","title":"CRUD Operations","text":""},{"location":"api/repository/#create","title":"Create","text":"<pre><code>public function create(array $data): int\n{\n    $stmt = $this-&gt;connection-&gt;prepare(\n        'INSERT INTO users (name, email, password) VALUES (?, ?, ?)'\n    );\n\n    $stmt-&gt;execute([\n        $data['name'],\n        $data['email'],\n        password_hash($data['password'], PASSWORD_BCRYPT)\n    ]);\n\n    return (int) $this-&gt;connection-&gt;lastInsertId();\n}\n</code></pre>"},{"location":"api/repository/#read","title":"Read","text":"<pre><code>public function findByEmail(string $email): ?array\n{\n    $stmt = $this-&gt;connection-&gt;prepare(\n        'SELECT * FROM users WHERE email = ?'\n    );\n    $stmt-&gt;execute([$email]);\n    return $stmt-&gt;fetch(\\PDO::FETCH_ASSOC) ?: null;\n}\n\npublic function findActive(): array\n{\n    $stmt = $this-&gt;connection-&gt;query(\n        'SELECT * FROM users WHERE active = 1 ORDER BY created_at DESC'\n    );\n    return $stmt-&gt;fetchAll(\\PDO::FETCH_ASSOC);\n}\n</code></pre>"},{"location":"api/repository/#update","title":"Update","text":"<pre><code>public function update(int $id, array $data): bool\n{\n    $stmt = $this-&gt;connection-&gt;prepare(\n        'UPDATE users SET name = ?, email = ? WHERE id = ?'\n    );\n\n    return $stmt-&gt;execute([\n        $data['name'],\n        $data['email'],\n        $id\n    ]);\n}\n</code></pre>"},{"location":"api/repository/#delete","title":"Delete","text":"<pre><code>public function delete(int $id): bool\n{\n    $stmt = $this-&gt;connection-&gt;prepare('DELETE FROM users WHERE id = ?');\n    return $stmt-&gt;execute([$id]);\n}\n\npublic function softDelete(int $id): bool\n{\n    $stmt = $this-&gt;connection-&gt;prepare(\n        'UPDATE users SET deleted_at = NOW() WHERE id = ?'\n    );\n    return $stmt-&gt;execute([$id]);\n}\n</code></pre>"},{"location":"api/repository/#transactions","title":"Transactions","text":""},{"location":"api/repository/#basic-transaction","title":"Basic Transaction","text":"<pre><code>public function transferFunds(int $fromId, int $toId, float $amount): void\n{\n    $this-&gt;connection-&gt;beginTransaction();\n\n    try {\n        // Deduct from sender\n        $stmt = $this-&gt;connection-&gt;prepare(\n            'UPDATE accounts SET balance = balance - ? WHERE id = ?'\n        );\n        $stmt-&gt;execute([$amount, $fromId]);\n\n        // Add to receiver\n        $stmt = $this-&gt;connection-&gt;prepare(\n            'UPDATE accounts SET balance = balance + ? WHERE id = ?'\n        );\n        $stmt-&gt;execute([$amount, $toId]);\n\n        $this-&gt;connection-&gt;commit();\n    } catch (\\Exception $e) {\n        $this-&gt;connection-&gt;rollback();\n        throw $e;\n    }\n}\n</code></pre>"},{"location":"api/repository/#query-building","title":"Query Building","text":""},{"location":"api/repository/#dynamic-filters","title":"Dynamic Filters","text":"<pre><code>public function search(array $filters): array\n{\n    $sql = 'SELECT * FROM users WHERE 1=1';\n    $params = [];\n\n    if (isset($filters['name'])) {\n        $sql .= ' AND name LIKE ?';\n        $params[] = '%' . $filters['name'] . '%';\n    }\n\n    if (isset($filters['email'])) {\n        $sql .= ' AND email = ?';\n        $params[] = $filters['email'];\n    }\n\n    if (isset($filters['active'])) {\n        $sql .= ' AND active = ?';\n        $params[] = (int) $filters['active'];\n    }\n\n    $stmt = $this-&gt;connection-&gt;prepare($sql);\n    $stmt-&gt;execute($params);\n    return $stmt-&gt;fetchAll(\\PDO::FETCH_ASSOC);\n}\n</code></pre>"},{"location":"api/repository/#pagination","title":"Pagination","text":"<pre><code>public function paginate(int $page = 1, int $perPage = 20): array\n{\n    $offset = ($page - 1) * $perPage;\n\n    // Get total count\n    $countStmt = $this-&gt;connection-&gt;query('SELECT COUNT(*) FROM users');\n    $total = (int) $countStmt-&gt;fetchColumn();\n\n    // Get page data\n    $stmt = $this-&gt;connection-&gt;prepare(\n        'SELECT * FROM users ORDER BY id DESC LIMIT ? OFFSET ?'\n    );\n    $stmt-&gt;execute([$perPage, $offset]);\n    $data = $stmt-&gt;fetchAll(\\PDO::FETCH_ASSOC);\n\n    return [\n        'data' =&gt; $data,\n        'total' =&gt; $total,\n        'page' =&gt; $page,\n        'perPage' =&gt; $perPage,\n        'totalPages' =&gt; (int) ceil($total / $perPage)\n    ];\n}\n</code></pre>"},{"location":"api/repository/#relationships","title":"Relationships","text":""},{"location":"api/repository/#one-to-many","title":"One-to-Many","text":"<pre><code>public function findWithPosts(int $userId): array\n{\n    // Get user\n    $user = $this-&gt;findById($userId);\n    if (!$user) {\n        return null;\n    }\n\n    // Get posts\n    $stmt = $this-&gt;connection-&gt;prepare(\n        'SELECT * FROM posts WHERE user_id = ? ORDER BY created_at DESC'\n    );\n    $stmt-&gt;execute([$userId]);\n    $user['posts'] = $stmt-&gt;fetchAll(\\PDO::FETCH_ASSOC);\n\n    return $user;\n}\n</code></pre>"},{"location":"api/repository/#many-to-many","title":"Many-to-Many","text":"<pre><code>public function findWithRoles(int $userId): array\n{\n    $user = $this-&gt;findById($userId);\n    if (!$user) {\n        return null;\n    }\n\n    $stmt = $this-&gt;connection-&gt;prepare('\n        SELECT r.* FROM roles r\n        INNER JOIN user_roles ur ON ur.role_id = r.id\n        WHERE ur.user_id = ?\n    ');\n    $stmt-&gt;execute([$userId]);\n    $user['roles'] = $stmt-&gt;fetchAll(\\PDO::FETCH_ASSOC);\n\n    return $user;\n}\n</code></pre>"},{"location":"api/repository/#advanced-patterns","title":"Advanced Patterns","text":""},{"location":"api/repository/#specification-pattern","title":"Specification Pattern","text":"<pre><code>interface SpecificationInterface\n{\n    public function toSql(): string;\n    public function getParameters(): array;\n}\n\nclass ActiveUserSpecification implements SpecificationInterface\n{\n    public function toSql(): string\n    {\n        return 'active = ?';\n    }\n\n    public function getParameters(): array\n    {\n        return [1];\n    }\n}\n\nclass UserRepository extends AbstractRepository\n{\n    public function findBySpecification(SpecificationInterface $spec): array\n    {\n        $sql = 'SELECT * FROM users WHERE ' . $spec-&gt;toSql();\n        $stmt = $this-&gt;connection-&gt;prepare($sql);\n        $stmt-&gt;execute($spec-&gt;getParameters());\n        return $stmt-&gt;fetchAll(\\PDO::FETCH_ASSOC);\n    }\n}\n</code></pre>"},{"location":"api/repository/#query-object-pattern","title":"Query Object Pattern","text":"<pre><code>class UserQuery\n{\n    private array $where = [];\n    private array $params = [];\n    private ?int $limit = null;\n    private ?int $offset = null;\n\n    public function whereActive(): self\n    {\n        $this-&gt;where[] = 'active = ?';\n        $this-&gt;params[] = 1;\n        return $this;\n    }\n\n    public function whereEmail(string $email): self\n    {\n        $this-&gt;where[] = 'email = ?';\n        $this-&gt;params[] = $email;\n        return $this;\n    }\n\n    public function limit(int $limit): self\n    {\n        $this-&gt;limit = $limit;\n        return $this;\n    }\n\n    public function toSql(): string\n    {\n        $sql = 'SELECT * FROM users';\n\n        if ($this-&gt;where) {\n            $sql .= ' WHERE ' . implode(' AND ', $this-&gt;where);\n        }\n\n        if ($this-&gt;limit) {\n            $sql .= ' LIMIT ' . $this-&gt;limit;\n        }\n\n        return $sql;\n    }\n\n    public function getParameters(): array\n    {\n        return $this-&gt;params;\n    }\n}\n\n// Usage\n$query = (new UserQuery())\n    -&gt;whereActive()\n    -&gt;whereEmail('user@example.com')\n    -&gt;limit(10);\n\n$stmt = $connection-&gt;prepare($query-&gt;toSql());\n$stmt-&gt;execute($query-&gt;getParameters());\n</code></pre>"},{"location":"api/repository/#complete-example","title":"Complete Example","text":"<pre><code>&lt;?php\n\nnamespace App\\Repository;\n\nuse Tusk\\Data\\Repository\\AbstractRepository;\nuse Tusk\\Data\\Driver\\ConnectionInterface;\n\nclass UserRepository extends AbstractRepository\n{\n    public function __construct(ConnectionInterface $connection)\n    {\n        parent::__construct($connection);\n    }\n\n    public function findAll(): array\n    {\n        $stmt = $this-&gt;connection-&gt;query('SELECT * FROM users ORDER BY id DESC');\n        return $stmt-&gt;fetchAll(\\PDO::FETCH_ASSOC);\n    }\n\n    public function findById(int $id): ?array\n    {\n        $stmt = $this-&gt;connection-&gt;prepare('SELECT * FROM users WHERE id = ?');\n        $stmt-&gt;execute([$id]);\n        return $stmt-&gt;fetch(\\PDO::FETCH_ASSOC) ?: null;\n    }\n\n    public function findByEmail(string $email): ?array\n    {\n        $stmt = $this-&gt;connection-&gt;prepare('SELECT * FROM users WHERE email = ?');\n        $stmt-&gt;execute([$email]);\n        return $stmt-&gt;fetch(\\PDO::FETCH_ASSOC) ?: null;\n    }\n\n    public function create(array $data): int\n    {\n        $stmt = $this-&gt;connection-&gt;prepare('\n            INSERT INTO users (name, email, password, created_at)\n            VALUES (?, ?, ?, NOW())\n        ');\n\n        $stmt-&gt;execute([\n            $data['name'],\n            $data['email'],\n            password_hash($data['password'], PASSWORD_BCRYPT)\n        ]);\n\n        return (int) $this-&gt;connection-&gt;lastInsertId();\n    }\n\n    public function update(int $id, array $data): bool\n    {\n        $stmt = $this-&gt;connection-&gt;prepare('\n            UPDATE users \n            SET name = ?, email = ?, updated_at = NOW()\n            WHERE id = ?\n        ');\n\n        return $stmt-&gt;execute([\n            $data['name'],\n            $data['email'],\n            $id\n        ]);\n    }\n\n    public function delete(int $id): bool\n    {\n        $stmt = $this-&gt;connection-&gt;prepare('DELETE FROM users WHERE id = ?');\n        return $stmt-&gt;execute([$id]);\n    }\n}\n</code></pre>"},{"location":"api/router/","title":"Router API Reference","text":"<p>The Router component handles HTTP request routing and controller resolution.</p>"},{"location":"api/router/#class-tuskwebrouterrouter","title":"Class: <code>Tusk\\Web\\Router\\Router</code>","text":""},{"location":"api/router/#basic-usage","title":"Basic Usage","text":"<pre><code>use Tusk\\Web\\Router\\Router;\nuse Tusk\\Core\\Container\\Container;\n\n$container = new Container();\n$router = new Router($container);\n\n// Register controllers\n$router-&gt;registerControllers([\n    \\App\\Controller\\UserController::class,\n    \\App\\Controller\\ProductController::class,\n]);\n\n// Dispatch request\n$request = Request::fromGlobals();\n$response = $router-&gt;dispatch($request);\n</code></pre>"},{"location":"api/router/#route-definition","title":"Route Definition","text":""},{"location":"api/router/#using-attributes","title":"Using Attributes","text":"<pre><code>use Tusk\\Web\\Attribute\\Route;\nuse Tusk\\Web\\Http\\Request;\nuse Tusk\\Web\\Http\\Response;\n\nclass UserController\n{\n    #[Route('/users', methods: ['GET'])]\n    public function list(Request $request): Response\n    {\n        // List all users\n    }\n\n    #[Route('/users/{id}', methods: ['GET'])]\n    public function show(Request $request, int $id): Response\n    {\n        // Show user by ID\n    }\n\n    #[Route('/users', methods: ['POST'])]\n    public function create(Request $request): Response\n    {\n        // Create new user\n    }\n\n    #[Route('/users/{id}', methods: ['PUT', 'PATCH'])]\n    public function update(Request $request, int $id): Response\n    {\n        // Update user\n    }\n\n    #[Route('/users/{id}', methods: ['DELETE'])]\n    public function delete(Request $request, int $id): Response\n    {\n        // Delete user\n    }\n}\n</code></pre>"},{"location":"api/router/#route-parameters","title":"Route Parameters","text":""},{"location":"api/router/#path-parameters","title":"Path Parameters","text":"<pre><code>#[Route('/posts/{id}/comments/{commentId}')]\npublic function showComment(Request $request, int $id, int $commentId): Response\n{\n    // $id = post ID\n    // $commentId = comment ID\n    return new Response(200, [], \"Post $id, Comment $commentId\");\n}\n</code></pre>"},{"location":"api/router/#optional-parameters","title":"Optional Parameters","text":"<pre><code>#[Route('/search/{query?}')]\npublic function search(Request $request, ?string $query = null): Response\n{\n    $query = $query ?? $request-&gt;getQueryParam('q', '');\n    // Search logic\n}\n</code></pre>"},{"location":"api/router/#type-constraints","title":"Type Constraints","text":"<pre><code>#[Route('/users/{id:\\d+}')]  // Only numeric IDs\npublic function show(Request $request, int $id): Response\n{\n    // ...\n}\n\n#[Route('/posts/{slug:[a-z0-9-]+}')]  // Alphanumeric slugs\npublic function showBySlug(Request $request, string $slug): Response\n{\n    // ...\n}\n</code></pre>"},{"location":"api/router/#request-methods","title":"Request Methods","text":""},{"location":"api/router/#method-restrictions","title":"Method Restrictions","text":"<pre><code>#[Route('/api/data', methods: ['GET', 'POST'])]\npublic function handleData(Request $request): Response\n{\n    if ($request-&gt;getMethod() === 'GET') {\n        // Return data\n    } else {\n        // Create data\n    }\n}\n</code></pre>"},{"location":"api/router/#restful-routes","title":"RESTful Routes","text":"<pre><code>class ProductController\n{\n    #[Route('/products', methods: ['GET'])]\n    public function index(Request $request): Response { }\n\n    #[Route('/products', methods: ['POST'])]\n    public function store(Request $request): Response { }\n\n    #[Route('/products/{id}', methods: ['GET'])]\n    public function show(Request $request, int $id): Response { }\n\n    #[Route('/products/{id}', methods: ['PUT'])]\n    public function update(Request $request, int $id): Response { }\n\n    #[Route('/products/{id}', methods: ['DELETE'])]\n    public function destroy(Request $request, int $id): Response { }\n}\n</code></pre>"},{"location":"api/router/#middleware-future-feature","title":"Middleware (Future Feature)","text":"<pre><code>use Tusk\\Web\\Attribute\\Middleware;\n\n#[Middleware(AuthMiddleware::class)]\nclass AdminController\n{\n    #[Route('/admin/users')]\n    public function users(Request $request): Response\n    {\n        // Only accessible after AuthMiddleware\n    }\n}\n</code></pre>"},{"location":"api/router/#route-groups-future-feature","title":"Route Groups (Future Feature)","text":"<pre><code>// Planned API for route grouping\n$router-&gt;group('/api/v1', function(Router $router) {\n    $router-&gt;registerControllers([\n        \\App\\Api\\V1\\UserController::class,\n        \\App\\Api\\V1\\ProductController::class,\n    ]);\n});\n</code></pre>"},{"location":"api/router/#error-handling","title":"Error Handling","text":""},{"location":"api/router/#404-not-found","title":"404 Not Found","text":"<pre><code>try {\n    $response = $router-&gt;dispatch($request);\n} catch (\\Tusk\\Web\\Exception\\RouteNotFoundException $e) {\n    $response = new Response(404, [], json_encode([\n        'error' =&gt; 'Route not found',\n        'path' =&gt; $request-&gt;getPath()\n    ]));\n}\n</code></pre>"},{"location":"api/router/#405-method-not-allowed","title":"405 Method Not Allowed","text":"<pre><code>try {\n    $response = $router-&gt;dispatch($request);\n} catch (\\Tusk\\Web\\Exception\\MethodNotAllowedException $e) {\n    $response = new Response(405, [\n        'Allow' =&gt; implode(', ', $e-&gt;getAllowedMethods())\n    ], json_encode([\n        'error' =&gt; 'Method not allowed',\n        'allowed' =&gt; $e-&gt;getAllowedMethods()\n    ]));\n}\n</code></pre>"},{"location":"api/router/#advanced-patterns","title":"Advanced Patterns","text":""},{"location":"api/router/#api-versioning","title":"API Versioning","text":"<pre><code>namespace App\\Api\\V1;\n\n#[Route('/api/v1/users')]\nclass UserController { }\n\nnamespace App\\Api\\V2;\n\n#[Route('/api/v2/users')]\nclass UserController { }\n</code></pre>"},{"location":"api/router/#content-negotiation","title":"Content Negotiation","text":"<pre><code>#[Route('/users/{id}', methods: ['GET'])]\npublic function show(Request $request, int $id): Response\n{\n    $user = $this-&gt;userRepo-&gt;find($id);\n\n    $accept = $request-&gt;getHeader('Accept');\n\n    if (str_contains($accept, 'application/json')) {\n        return new Response(200, \n            ['Content-Type' =&gt; 'application/json'],\n            json_encode($user)\n        );\n    }\n\n    if (str_contains($accept, 'application/xml')) {\n        return new Response(200,\n            ['Content-Type' =&gt; 'application/xml'],\n            $this-&gt;toXml($user)\n        );\n    }\n\n    return new Response(406, [], 'Not Acceptable');\n}\n</code></pre>"},{"location":"api/router/#complete-example","title":"Complete Example","text":"<pre><code>&lt;?php\n// public/index.php\n\nuse Tusk\\Core\\Container\\Container;\nuse Tusk\\Web\\Router\\Router;\nuse Tusk\\Web\\Http\\Request;\n\n// Bootstrap\n$container = require __DIR__ . '/../bootstrap.php';\n\n// Create router\n$router = new Router($container);\n\n// Register all controllers\n$router-&gt;registerControllers([\n    \\App\\Controller\\HomeController::class,\n    \\App\\Controller\\UserController::class,\n    \\App\\Controller\\ProductController::class,\n    \\App\\Controller\\OrderController::class,\n]);\n\n// Handle request\n$request = Request::fromGlobals();\n\ntry {\n    $response = $router-&gt;dispatch($request);\n} catch (\\Tusk\\Web\\Exception\\RouteNotFoundException $e) {\n    $response = new Response(404, [], 'Not Found');\n} catch (\\Tusk\\Web\\Exception\\MethodNotAllowedException $e) {\n    $response = new Response(405, ['Allow' =&gt; implode(', ', $e-&gt;getAllowedMethods())]);\n} catch (\\Throwable $e) {\n    error_log($e-&gt;getMessage());\n    $response = new Response(500, [], 'Internal Server Error');\n}\n\n// Send response\n$response-&gt;send();\n</code></pre>"},{"location":"architecture/core/","title":"Core (Dependency Injection)","text":"<p>The <code>tusk-core</code> component provides the foundation for dependency management.</p>"},{"location":"architecture/core/#container","title":"Container","text":"<p>The <code>Container</code> class is a simple, attribute-based DI container.</p>"},{"location":"architecture/core/#basic-usage","title":"Basic Usage","text":"<pre><code>use Tusk\\Core\\Container\\Container;\n\n$container = new Container();\n\n// Register a service\n$container-&gt;set(DatabaseConnection::class, function() {\n    return new DatabaseConnection('mysql:host=localhost');\n});\n\n// Resolve a service\n$db = $container-&gt;get(DatabaseConnection::class);\n</code></pre>"},{"location":"architecture/core/#auto-wiring","title":"Auto-Wiring","text":"<p>The container can automatically resolve constructor dependencies:</p> <pre><code>class UserService\n{\n    public function __construct(\n        private UserRepository $repo,\n        private Logger $logger\n    ) {}\n}\n\n// Container will automatically inject dependencies\n$service = $container-&gt;get(UserService::class);\n</code></pre>"},{"location":"architecture/core/#contracts","title":"Contracts","text":"<p>Core interfaces that define framework behavior:</p> <ul> <li><code>ContainerInterface</code> - DI container contract</li> <li><code>KernelInterface</code> - Application kernel contract</li> <li><code>ServiceProviderInterface</code> - Service registration</li> </ul>"},{"location":"architecture/core/#attributes","title":"Attributes","text":"<p>PHP 8 attributes for declarative configuration:</p> <ul> <li><code>#[Service]</code> - Mark a class as a service</li> <li><code>#[Singleton]</code> - Register as singleton</li> <li><code>#[Inject]</code> - Explicit dependency injection</li> </ul>"},{"location":"architecture/core/#example-service-provider","title":"Example: Service Provider","text":"<pre><code>use Tusk\\Core\\Attribute\\Service;\n\n#[Service]\nclass AppServiceProvider\n{\n    public function register(Container $container): void\n    {\n        $container-&gt;set(LoggerInterface::class, function() {\n            return new FileLogger('/var/log/app.log');\n        });\n    }\n}\n</code></pre>"},{"location":"architecture/data/","title":"Data (Repository)","text":"<p>The <code>tusk-data</code> component provides database abstraction and repository pattern.</p>"},{"location":"architecture/data/#pdoconnection","title":"PdoConnection","text":"<p>Resilient PDO wrapper with automatic reconnection:</p> <pre><code>use Tusk\\Data\\Driver\\Pdo\\PdoConnection;\n\n$db = new PdoConnection('mysql:host=localhost;dbname=app', 'user', 'pass');\n</code></pre>"},{"location":"architecture/data/#abstractrepository","title":"AbstractRepository","text":"<p>Base class for clean data access:</p> <pre><code>use Tusk\\Data\\Repository\\AbstractRepository;\n\nclass UserRepository extends AbstractRepository\n{\n    public function findByEmail(string $email): ?array\n    {\n        $stmt = $this-&gt;connection-&gt;prepare('SELECT * FROM users WHERE email = ?');\n        $stmt-&gt;execute([$email]);\n        return $stmt-&gt;fetch(\\PDO::FETCH_ASSOC) ?: null;\n    }\n}\n</code></pre>"},{"location":"architecture/data/#transactions","title":"Transactions","text":"<pre><code>$db-&gt;beginTransaction();\ntry {\n    // ... operations\n    $db-&gt;commit();\n} catch (\\Exception $e) {\n    $db-&gt;rollback();\n}\n</code></pre> <p>Full documentation coming soon.</p>"},{"location":"architecture/engine-spec/","title":"Tusk Native Engine Specification (Draft)","text":"<p>Status: Visionary Spec v0.1 Note: This component is currently in the Spec Phase.</p>"},{"location":"architecture/engine-spec/#overview","title":"Overview","text":"<p>The Tusk Native Engine is the high-performance backbone of the Tusk Framework. Written in a low-level language (Rust or Go), it serves as the Master Process that manages, protects, and feeds work to the persistent PHP Worker processes.</p>"},{"location":"architecture/engine-spec/#core-responsibilities","title":"Core Responsibilities","text":""},{"location":"architecture/engine-spec/#1-process-supervision-master","title":"1. Process Supervision (Master)","text":"<ul> <li>Spawn &amp; Monitor: Spawns a configured number of PHP workers.</li> <li>Self-Healing: Automatically restarts PHP workers if they crash or exit due to memory limits.</li> <li>Graceful Orchestration: Coordinates the startup (<code>#[OnStart]</code>) and shutdown (<code>#[OnShutdown]</code>) signals across the cluster.</li> </ul>"},{"location":"architecture/engine-spec/#2-high-performance-io-adapters","title":"2. High-Performance I/O (Adapters)","text":"<ul> <li>Non-blocking Server: Handles raw HTTP/1.1, HTTP/2, and HTTP/3 connections.</li> <li>Socket Management: Manages thousands of concurrent WebSockets.</li> <li>Protocol Translation: Translates incoming requests into a fast IPC format (e.g., Protobuf or MsgPack) for the PHP workers.</li> </ul>"},{"location":"architecture/engine-spec/#3-inter-process-communication-ipc","title":"3. Inter-Process Communication (IPC)","text":"<ul> <li>Fast Bridge: Communication via Unix Sockets, Shared Memory, or high-speed temporary file-pipes.</li> <li>Request/Response Loop: Forwards incoming work to an idle worker and returns the result to the client.</li> </ul>"},{"location":"architecture/engine-spec/#proposed-architecture","title":"Proposed Architecture","text":"<pre><code>graph TB\n    subgraph Engine [\"TUSK ENGINE (Master)\"]\n        IO[\"I/O (Net)\"]\n        Supervisor[\"Supervisor (Process)\"]\n    end\n\n    subgraph Worker [\"TUSK PHP WORKER (Child)\"]\n        Container[\"Container\"]\n        App[\"Domain/App\"]\n    end\n\n    IO --&gt; Supervisor\n    Supervisor --&gt;|IPC| Worker\n    Supervisor --&gt;|Signals| Worker\n</code></pre>"},{"location":"architecture/engine-spec/#why-rustgo","title":"Why Rust/Go?","text":"<ul> <li>Immutability of the Master Path: The master process should never crash.</li> <li>Parallelism: Real multi-threading for the Network stack, while PHP remains single-threaded per worker.</li> <li>Zero-Dependency CLI: The <code>tusk</code> binary is statically compiled and includes the engine.</li> </ul>"},{"location":"architecture/engine-spec/#future-integration","title":"Future Integration","text":"<p>The <code>tusk-engine</code> will eventually expose APIs for: - Hot Reloading without dropping connections. - Shared State (In-memory key-value store shared across PHP workers). - Native Metrics (Prometheus/OpenTelemetry) gathered directly from the engine.</p>"},{"location":"architecture/engine/","title":"Tusk Native Engine","text":"<p>The Tusk Native Engine is the high-performance application server that powers the Tusk Framework. Built in Go, it replaces the traditional <code>php-fpm</code> + <code>nginx</code> stack with a single, modern binary.</p>"},{"location":"architecture/engine/#why-a-native-engine","title":"Why a Native Engine?","text":"<p>PHP is traditionally single-threaded and relies on a process manager (FPM) and a web server (Nginx/Apache). Tusk Engine consolidates these into one:</p> <ul> <li>Performance: Handles connection pooling, keep-alive, and static files using Go's highly efficient <code>net/http</code>.</li> <li>Isolation: The engine protects the robust server layer from PHP crashes.</li> <li>Portability: It manages the PHP runtime itself (\"Sidecar\" mode), meaning you don't even need PHP installed on the host system to run a Tusk app.</li> </ul>"},{"location":"architecture/engine/#architecture","title":"Architecture","text":"<p>The engine uses a Master-Worker architecture:</p> <ol> <li>Master (Go): Accepts incoming HTTP requests.</li> <li>IPC (Pipes): Forwards the request (Method, Headers, Body) to a PHP worker via Standard I/O (NDJSON).</li> <li>Worker (PHP): Boots the framework once (or reuses state) and processes the request.</li> <li>Response: The worker writes the response JSON back to the Master, which streams it to the client.</li> </ol> <pre><code>graph TD\n    subgraph Engine [\"Tusk Engine (Go)\"]\n        Server[\"HTTP Server\"] --&gt; Pool[\"Worker Pool\"]\n    end\n\n    Pool -- \"stdin / stdout (NDJSON)\" --&gt; Worker[\"PHP Worker (Framework)\"]\n\n    style Engine fill:#f9f9f9,stroke:#333,stroke-width:2px\n    style Worker fill:#fff,stroke:#333,stroke-width:2px\n</code></pre> <pre><code>sequenceDiagram\n    Client-&gt;&gt;Tusk Engine: HTTP Request\n    Tusk Engine-&gt;&gt;PHP Worker: JSON Payload (stdin)\n    Note over PHP Worker: Process Request\n    PHP Worker--&gt;&gt;Tusk Engine: JSON Response (stdout)\n    Tusk Engine--&gt;&gt;Client: HTTP Response\n</code></pre>"},{"location":"architecture/engine/#usage","title":"Usage","text":"<p>The <code>tusk</code> binary is the single entry point for everything.</p>"},{"location":"architecture/engine/#starting-the-server","title":"Starting the Server","text":"<pre><code>tusk start\n</code></pre> <p>This boots the server on port 8080 (default).</p>"},{"location":"architecture/engine/#framework-commands","title":"Framework Commands","text":"<p>The engine also acts as a proxy for your PHP commands. You don't need to run <code>php console ...</code>.</p> <pre><code>tusk make:controller User\ntusk migrate\ntusk list\n</code></pre>"},{"location":"architecture/engine/#configuration","title":"Configuration","text":"<p>Control the engine behavior using <code>tusk.json</code> in your project root:</p> <pre><code>{\n    \"port\": 8080,\n    \"worker_count\": 4,\n    \"address\": \"0.0.0.0\",\n    \"php_binary\": \".tusk/bin/php\", \n    \"php_ini\": \"config/php.ini\"\n}\n</code></pre> <ul> <li>port: The HTTP port to listen on.</li> <li>worker_count: How many concurrent PHP processes to maintain.</li> <li>php_binary: Path to the PHP executable (can be absolute or relative).</li> </ul>"},{"location":"architecture/micro/","title":"Micro (Microservices)","text":"<p>The <code>tusk-micro</code> component provides utilities for cloud-native microservices.</p>"},{"location":"architecture/micro/#health-checks","title":"Health Checks","text":"<p>Standard Kubernetes-style health endpoints:</p> <pre><code>use Tusk\\Micro\\Health\\HealthCheckRegistry;\nuse Tusk\\Micro\\Controller\\HealthController;\n\n$registry = new HealthCheckRegistry();\n$registry-&gt;register(new DatabaseCheck());\n\n$controller = new HealthController($registry);\n</code></pre> <p>Endpoints: - <code>/health/live</code> - Liveness probe (always UP) - <code>/health/ready</code> - Readiness probe (checks registry)</p>"},{"location":"architecture/micro/#metrics","title":"Metrics","text":"<p>Prometheus-compatible metrics:</p> <pre><code>use Tusk\\Micro\\Metric\\Prometheus;\n\n$metrics = new Prometheus();\n$metrics-&gt;counter('requests_total')-&gt;inc();\n</code></pre>"},{"location":"architecture/micro/#rpc-interfaces","title":"RPC Interfaces","text":"<p>Define gRPC-style service contracts:</p> <pre><code>use Tusk\\Micro\\Rpc\\RpcServiceInterface;\n\ninterface UserServiceInterface extends RpcServiceInterface\n{\n    public function getUser(int $id): User;\n}\n</code></pre> <p>Full documentation coming soon.</p>"},{"location":"architecture/overview/","title":"Architecture Overview","text":"<p>Tusk is built on a modular, layered architecture that separates concerns and promotes clean code.</p>"},{"location":"architecture/overview/#core-principles","title":"Core Principles","text":"<ol> <li>Dependency Injection First: All components use constructor injection</li> <li>Attribute-Based Configuration: Routes, services, and more via PHP 8 attributes</li> <li>Repository Pattern: Clean separation between domain and data access</li> <li>Process Supervision: Long-running workers with automatic restart</li> </ol>"},{"location":"architecture/overview/#component-layers","title":"Component Layers","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          External Traffic           \u2502\n\u2502        (HTTP/TCP, Port 8080)        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         Tusk Engine (Go)            \u2502\n\u2502  (Master, Listener, NDJSON Proxy)   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         Framework Layer             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 tusk-web \u2502  \u2502   tusk-micro     \u2502 \u2502\n\u2502  \u2502 (Logic)  \u2502  \u2502 (Resilience)     \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502tusk-data \u2502  \u2502   tusk-cli       \u2502 \u2502\n\u2502  \u2502 (Repos)  \u2502  \u2502 (Command Logic)  \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         Runtime Layer               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502      tusk-runtime            \u2502   \u2502\n\u2502  \u2502  (IPC Loop, Runner, Kernel)  \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502          Core Layer                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502       tusk-core              \u2502   \u2502\n\u2502  \u2502  (Container, Contracts)      \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/overview/#request-lifecycle","title":"Request Lifecycle","text":""},{"location":"architecture/overview/#http-request-flow","title":"HTTP Request Flow","text":"<ol> <li>Tusk Engine (Go) receives the HTTP request.</li> <li>IPC Bridge forwards the request to a PHP worker over NDJSON.</li> <li>Runtime Runner (PHP) parses the NDJSON into a <code>Request</code> object.</li> <li>Kernel dispatches to the <code>Router</code>.</li> <li>Router matches the route and resolves the <code>Controller</code>.</li> <li>Container injects dependencies into the controller.</li> <li>Controller returns a <code>Response</code>.</li> <li>Runner sends the response back to Go over NDJSON to be served.</li> </ol>"},{"location":"architecture/overview/#cli-command-flow","title":"CLI Command Flow","text":"<ol> <li>Tusk Binary (Go) receives a command (e.g., <code>init</code> or <code>migrate</code>).</li> <li>Command Proxy determines if it's a native command or framework command.</li> <li>PHP Worker is spawned to execute the logic for framework-aware commands.</li> <li>Generator (for <code>init</code>) scaffolds project files.</li> <li>Exit with status code</li> </ol>"},{"location":"architecture/overview/#component-details","title":"Component Details","text":"<ul> <li>Core (DI) - Dependency injection container</li> <li>Runtime (Supervisor) - Process management</li> <li>Web (HTTP) - Server, router, request handling</li> <li>Data (Repository) - Database abstraction</li> <li>Micro (Services) - Microservice utilities</li> </ul>"},{"location":"architecture/runtime/","title":"Runtime (IPC Runner)","text":""},{"location":"architecture/runtime/#the-runner-tuskruntimerunner","title":"The Runner (<code>Tusk\\Runtime\\Runner</code>)","text":"<p>The <code>Runner</code> is the heart of the PHP worker. It handles the continuous IPC loop with the Go Master Process.</p> <pre><code>use Tusk\\Runtime\\Runner;\n\n// Runner::run() starts the blocking NDJSON loop\nRunner::run($kernel);\n</code></pre>"},{"location":"architecture/runtime/#ipc-lifecycle","title":"IPC Lifecycle","text":"<ol> <li>Wait: The Runner waits for a newline-delimited JSON string on <code>stdin</code>.</li> <li>Boot: It parses the request and executes the Kernel.</li> <li>Flush: It writes the response as NDJSON to <code>stdout</code> and signals readiness for the next request.</li> </ol>"},{"location":"architecture/runtime/#kernel-integration","title":"Kernel Integration","text":"<p>The <code>Kernel</code> manages the application state across multiple requests. Because workers are persistent, the Kernel can cache containers, DB connections, and pre-compiled templates.</p>"},{"location":"architecture/runtime/#process-manager","title":"Process Manager","text":"<p>Cross-platform process management (Windows/Linux compatible).</p>"},{"location":"architecture/runtime/#worker-pool","title":"Worker Pool","text":"<p>Manage multiple worker processes for parallel task execution.</p> <p>Full documentation coming soon.</p>"},{"location":"architecture/web/","title":"Web (HTTP)","text":"<p>The <code>tusk-web</code> component provides HTTP server, routing, and request handling.</p>"},{"location":"architecture/web/#native-http-server","title":"Native HTTP Server","text":"<p>Pure PHP socket-based server (no Nginx/Apache required):</p> <pre><code>use Tusk\\Web\\Server\\HttpServer;\n\n$server = new HttpServer('127.0.0.1', 8080, $kernel);\n$server-&gt;start();\n</code></pre>"},{"location":"architecture/web/#router","title":"Router","text":"<p>Attribute-based routing:</p> <pre><code>use Tusk\\Web\\Attribute\\Route;\n\nclass UserController\n{\n    #[Route('/users/{id}', methods: ['GET'])]\n    public function show(int $id): Response\n    {\n        // ...\n    }\n}\n</code></pre>"},{"location":"architecture/web/#requestresponse","title":"Request/Response","text":"<p>PSR-7 compatible request and response objects.</p> <p>Full documentation coming soon.</p>"},{"location":"getting-started/first-app/","title":"Your First App","text":"<p>Let's build a simple Todo API with database persistence.</p>"},{"location":"getting-started/first-app/#setup-database","title":"Setup Database","text":"<p>Update <code>docker-compose.yml</code> (already included in generated project):</p> <pre><code>services:\n  db:\n    image: mysql:8.0\n    environment:\n      MYSQL_ROOT_PASSWORD: secret\n      MYSQL_DATABASE: todos\n</code></pre>"},{"location":"getting-started/first-app/#create-repository","title":"Create Repository","text":"<p><code>src/Repository/TodoRepository.php</code>:</p> <pre><code>&lt;?php\nnamespace App\\Repository;\n\nuse Tusk\\Data\\Repository\\AbstractRepository;\n\nclass TodoRepository extends AbstractRepository\n{\n    public function findAll(): array\n    {\n        $stmt = $this-&gt;connection-&gt;query('SELECT * FROM todos');\n        return $stmt-&gt;fetchAll(\\PDO::FETCH_ASSOC);\n    }\n\n    public function create(string $title): int\n    {\n        $stmt = $this-&gt;connection-&gt;prepare(\n            'INSERT INTO todos (title, completed) VALUES (?, 0)'\n        );\n        $stmt-&gt;execute([$title]);\n        return (int) $this-&gt;connection-&gt;lastInsertId();\n    }\n}\n</code></pre>"},{"location":"getting-started/first-app/#create-controller","title":"Create Controller","text":"<p><code>src/Controller/TodoController.php</code>:</p> <pre><code>&lt;?php\nnamespace App\\Controller;\n\nuse App\\Repository\\TodoRepository;\nuse Tusk\\Web\\Attribute\\Route;\nuse Tusk\\Web\\Http\\Request;\nuse Tusk\\Web\\Http\\Response;\n\nclass TodoController\n{\n    public function __construct(\n        private TodoRepository $todos\n    ) {}\n\n    #[Route('/todos', methods: ['GET'])]\n    public function list(Request $request): Response\n    {\n        $todos = $this-&gt;todos-&gt;findAll();\n        return new Response(200, ['Content-Type' =&gt; 'application/json'],\n            json_encode($todos));\n    }\n\n    #[Route('/todos', methods: ['POST'])]\n    public function create(Request $request): Response\n    {\n        $data = json_decode($request-&gt;getBody(), true);\n        $id = $this-&gt;todos-&gt;create($data['title']);\n\n        return new Response(201, ['Content-Type' =&gt; 'application/json'],\n            json_encode(['id' =&gt; $id]));\n    }\n}\n</code></pre>"},{"location":"getting-started/first-app/#run-migrations","title":"Run Migrations","text":"<p>Create <code>migrations/001_create_todos.sql</code>:</p> <pre><code>CREATE TABLE todos (\n    id INT AUTO_INCREMENT PRIMARY KEY,\n    title VARCHAR(255) NOT NULL,\n    completed BOOLEAN DEFAULT FALSE,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n</code></pre> <p>Run it:</p> <pre><code>docker-compose exec db mysql -uroot -psecret todos &lt; migrations/001_create_todos.sql\n</code></pre>"},{"location":"getting-started/first-app/#test-it","title":"Test It","text":"<pre><code># List todos\ncurl http://localhost:8080/todos\n\n# Create todo\ncurl -X POST http://localhost:8080/todos \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"title\":\"Learn Tusk\"}'\n</code></pre> <p>Congratulations! You've built a working API with Tusk.</p>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>PHP 8.2 or higher</li> <li>Composer (for dependency management)</li> <li>PDO extension (for database access)</li> </ul>"},{"location":"getting-started/installation/#one-line-installation-recommended","title":"One-Line Installation (Recommended)","text":"<p>Get Tusk and a portable PHP runtime installed in seconds.</p>"},{"location":"getting-started/installation/#linux-macos","title":"Linux / macOS","text":"<pre><code>curl -fsSL https://tusk.sh/install.sh | bash\n</code></pre>"},{"location":"getting-started/installation/#windows-powershell","title":"Windows (PowerShell)","text":"<pre><code>iwr -useb https://tusk.sh/install.ps1 | iex\n</code></pre> <p>These scripts download the <code>tusk</code> binary and a pre-configured PHP runtime into <code>~/.tusk</code> (or <code>%USERPROFILE%\\.tusk</code>) and add them to your PATH.</p>"},{"location":"getting-started/installation/#docker-containerized","title":"Docker (Containerized)","text":"<p>Tusk provides a ready-to-use Docker image via the GitHub Container Registry (GHCR). This is perfect for CI/CD or production environments.</p>"},{"location":"getting-started/installation/#pull-the-image","title":"Pull the Image","text":"<pre><code>docker pull ghcr.io/tusk-framework/tusk-engine:main\n</code></pre>"},{"location":"getting-started/installation/#run-a-local-project","title":"Run a Local Project","text":"<p>Map your project directory to <code>/app</code> inside the container:</p> <pre><code>docker run -p 8080:8080 -v $(pwd):/app ghcr.io/tusk-framework/tusk-engine:main\n</code></pre>"},{"location":"getting-started/installation/#manual-installation","title":"Manual Installation","text":"<p>If you prefer to manage your own PHP version:</p> <ol> <li>Download the latest <code>tusk</code> binary for your platform from Releases.</li> <li>Add the binary to your system PATH.</li> <li>Ensure you have PHP 8.2+ installed.</li> </ol>"},{"location":"getting-started/installation/#via-composer","title":"Via Composer","text":"<p>For development or contributing to the framework:</p> <pre><code># Clone the monorepo\ngit clone https://github.com/tusk-framework/tusk-framework.git\ncd tusk\n\n# Install dependencies\ncomposer install\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<pre><code>tusk setup\n</code></pre> <p>Output:</p> <pre><code>Project Root: /home/user/project\nPHP Found: /home/user/.tusk/php/bin/php\nTusk is ready to go!\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<p>Continue to Quick Start to create your first project.</p>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>This guide will walk you through creating your first Tusk application in under 5 minutes.</p>"},{"location":"getting-started/quickstart/#create-a-project","title":"Create a Project","text":"<pre><code>tusk init my-api\ncd my-api\n</code></pre> <p>This generates: - <code>composer.json</code> - Dependency configuration - <code>docker-compose.yml</code> - Local development environment - <code>public/index.php</code> - Application entry point - <code>src/Controller/HomeController.php</code> - Sample controller</p>"},{"location":"getting-started/quickstart/#install-dependencies","title":"Install Dependencies","text":"<pre><code>composer install\n</code></pre>"},{"location":"getting-started/quickstart/#run-the-server","title":"Run the Server","text":""},{"location":"getting-started/quickstart/#option-1-native-startup-recommended","title":"Option 1: Native Startup (Recommended)","text":"<pre><code>tusk start\n</code></pre> <p>This boots the Go engine and spawns PHP workers automatically. Visit <code>http://localhost:8080</code>.</p>"},{"location":"getting-started/quickstart/#option-2-docker-containerized","title":"Option 2: Docker (Containerized)","text":"<p>If you have Docker installed, you can pull the official engine image:</p> <pre><code>docker pull ghcr.io/tusk-framework/tusk-engine:main\ndocker run -p 8080:8080 -v $(pwd):/app ghcr.io/tusk-framework/tusk-engine:main\n</code></pre> <p>Visit <code>http://localhost:8080</code></p>"},{"location":"getting-started/quickstart/#your-first-endpoint","title":"Your First Endpoint","text":"<p>The generated project includes a sample controller:</p> <pre><code>&lt;?php\nnamespace App\\Controller;\n\nuse Tusk\\Web\\Attribute\\Route;\nuse Tusk\\Web\\Http\\Request;\nuse Tusk\\Web\\Http\\Response;\n\nclass HomeController\n{\n    #[Route('/', methods: ['GET'])]\n    public function index(Request $request): Response\n    {\n        return new Response(200, ['Content-Type' =&gt; 'application/json'], json_encode([\n            'message' =&gt; 'Welcome to Tusk!',\n            'version' =&gt; '0.7.0'\n        ]));\n    }\n}\n</code></pre>"},{"location":"getting-started/quickstart/#add-a-new-route","title":"Add a New Route","text":"<p>Create <code>src/Controller/UserController.php</code>:</p> <pre><code>&lt;?php\nnamespace App\\Controller;\n\nuse Tusk\\Web\\Attribute\\Route;\nuse Tusk\\Web\\Http\\Request;\nuse Tusk\\Web\\Http\\Response;\n\nclass UserController\n{\n    #[Route('/users', methods: ['GET'])]\n    public function list(Request $request): Response\n    {\n        $users = [\n            ['id' =&gt; 1, 'name' =&gt; 'Alice'],\n            ['id' =&gt; 2, 'name' =&gt; 'Bob'],\n        ];\n\n        return new Response(200, ['Content-Type' =&gt; 'application/json'], \n            json_encode($users));\n    }\n}\n</code></pre> <p>Register it in <code>public/index.php</code>:</p> <pre><code>$router-&gt;registerControllers([\n    \\App\\Controller\\HomeController::class,\n    \\App\\Controller\\UserController::class, // Add this\n]);\n</code></pre> <p>Visit <code>http://localhost:8080/users</code> to see your new endpoint!</p>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>Learn about Your First App with database integration</li> <li>Explore the Architecture</li> <li>Read the CLI Usage Guide</li> </ul>"},{"location":"guides/authentication/","title":"Authentication Guide","text":"<p>Implement authentication and authorization in your Tusk applications.</p>"},{"location":"guides/authentication/#jwt-authentication","title":"JWT Authentication","text":""},{"location":"guides/authentication/#setup","title":"Setup","text":"<pre><code>composer require firebase/php-jwt\n</code></pre>"},{"location":"guides/authentication/#jwt-service","title":"JWT Service","text":"<pre><code>&lt;?php\n\nnamespace App\\Service;\n\nuse Firebase\\JWT\\JWT;\nuse Firebase\\JWT\\Key;\n\nclass JwtService\n{\n    private string $secret;\n    private string $algorithm = 'HS256';\n\n    public function __construct(string $secret)\n    {\n        $this-&gt;secret = $secret;\n    }\n\n    public function encode(array $payload): string\n    {\n        $payload['iat'] = time();\n        $payload['exp'] = time() + (60 * 60 * 24); // 24 hours\n\n        return JWT::encode($payload, $this-&gt;secret, $this-&gt;algorithm);\n    }\n\n    public function decode(string $token): object\n    {\n        return JWT::decode($token, new Key($this-&gt;secret, $this-&gt;algorithm));\n    }\n\n    public function verify(string $token): bool\n    {\n        try {\n            $this-&gt;decode($token);\n            return true;\n        } catch (\\Exception $e) {\n            return false;\n        }\n    }\n}\n</code></pre>"},{"location":"guides/authentication/#auth-service","title":"Auth Service","text":"<pre><code>&lt;?php\n\nnamespace App\\Service;\n\nuse App\\Repository\\UserRepository;\n\nclass AuthService\n{\n    public function __construct(\n        private UserRepository $userRepo,\n        private JwtService $jwt\n    ) {}\n\n    public function login(string $email, string $password): ?string\n    {\n        $user = $this-&gt;userRepo-&gt;findByEmail($email);\n\n        if (!$user || !password_verify($password, $user['password'])) {\n            return null;\n        }\n\n        return $this-&gt;jwt-&gt;encode([\n            'user_id' =&gt; $user['id'],\n            'email' =&gt; $user['email'],\n        ]);\n    }\n\n    public function verify(string $token): ?array\n    {\n        try {\n            $payload = $this-&gt;jwt-&gt;decode($token);\n            return $this-&gt;userRepo-&gt;findById($payload-&gt;user_id);\n        } catch (\\Exception $e) {\n            return null;\n        }\n    }\n\n    public function register(array $data): int\n    {\n        $data['password'] = password_hash($data['password'], PASSWORD_BCRYPT);\n        return $this-&gt;userRepo-&gt;create($data);\n    }\n}\n</code></pre>"},{"location":"guides/authentication/#auth-controller","title":"Auth Controller","text":"<pre><code>&lt;?php\n\nnamespace App\\Controller;\n\nuse Tusk\\Web\\Attribute\\Route;\nuse Tusk\\Web\\Http\\Request;\nuse Tusk\\Web\\Http\\Response;\nuse App\\Service\\AuthService;\n\nclass AuthController\n{\n    public function __construct(\n        private AuthService $auth\n    ) {}\n\n    #[Route('/auth/register', methods: ['POST'])]\n    public function register(Request $request): Response\n    {\n        $data = json_decode($request-&gt;getBody(), true);\n\n        // Validate\n        if (!isset($data['email'], $data['password'], $data['name'])) {\n            return new Response(400, [], json_encode([\n                'error' =&gt; 'Missing required fields'\n            ]));\n        }\n\n        // Register user\n        try {\n            $userId = $this-&gt;auth-&gt;register($data);\n\n            return new Response(201, [], json_encode([\n                'id' =&gt; $userId,\n                'message' =&gt; 'User registered successfully'\n            ]));\n        } catch (\\Exception $e) {\n            return new Response(500, [], json_encode([\n                'error' =&gt; 'Registration failed'\n            ]));\n        }\n    }\n\n    #[Route('/auth/login', methods: ['POST'])]\n    public function login(Request $request): Response\n    {\n        $data = json_decode($request-&gt;getBody(), true);\n\n        if (!isset($data['email'], $data['password'])) {\n            return new Response(400, [], json_encode([\n                'error' =&gt; 'Email and password required'\n            ]));\n        }\n\n        $token = $this-&gt;auth-&gt;login($data['email'], $data['password']);\n\n        if (!$token) {\n            return new Response(401, [], json_encode([\n                'error' =&gt; 'Invalid credentials'\n            ]));\n        }\n\n        return new Response(200, [], json_encode([\n            'token' =&gt; $token\n        ]));\n    }\n\n    #[Route('/auth/me', methods: ['GET'])]\n    public function me(Request $request): Response\n    {\n        $authHeader = $request-&gt;getHeader('Authorization');\n\n        if (!$authHeader || !str_starts_with($authHeader, 'Bearer ')) {\n            return new Response(401, [], json_encode([\n                'error' =&gt; 'Unauthorized'\n            ]));\n        }\n\n        $token = substr($authHeader, 7);\n        $user = $this-&gt;auth-&gt;verify($token);\n\n        if (!$user) {\n            return new Response(401, [], json_encode([\n                'error' =&gt; 'Invalid token'\n            ]));\n        }\n\n        // Remove sensitive data\n        unset($user['password']);\n\n        return new Response(200, [], json_encode($user));\n    }\n}\n</code></pre>"},{"location":"guides/authentication/#middleware-future-feature","title":"Middleware (Future Feature)","text":"<pre><code>&lt;?php\n\nnamespace App\\Middleware;\n\nuse Tusk\\Web\\Http\\Request;\nuse Tusk\\Web\\Http\\Response;\nuse App\\Service\\AuthService;\n\nclass AuthMiddleware\n{\n    public function __construct(\n        private AuthService $auth\n    ) {}\n\n    public function handle(Request $request, callable $next): Response\n    {\n        $authHeader = $request-&gt;getHeader('Authorization');\n\n        if (!$authHeader || !str_starts_with($authHeader, 'Bearer ')) {\n            return new Response(401, [], json_encode([\n                'error' =&gt; 'Unauthorized'\n            ]));\n        }\n\n        $token = substr($authHeader, 7);\n        $user = $this-&gt;auth-&gt;verify($token);\n\n        if (!$user) {\n            return new Response(401, [], json_encode([\n                'error' =&gt; 'Invalid token'\n            ]));\n        }\n\n        // Attach user to request\n        $request-&gt;setAttribute('user', $user);\n\n        return $next($request);\n    }\n}\n</code></pre>"},{"location":"guides/authentication/#protected-routes","title":"Protected Routes","text":""},{"location":"guides/authentication/#manual-check","title":"Manual Check","text":"<pre><code>#[Route('/users/{id}', methods: ['PUT'])]\npublic function update(Request $request, int $id): Response\n{\n    // Get authenticated user\n    $authHeader = $request-&gt;getHeader('Authorization');\n    if (!$authHeader) {\n        return new Response(401, [], json_encode(['error' =&gt; 'Unauthorized']));\n    }\n\n    $token = substr($authHeader, 7);\n    $user = $this-&gt;auth-&gt;verify($token);\n\n    if (!$user) {\n        return new Response(401, [], json_encode(['error' =&gt; 'Invalid token']));\n    }\n\n    // Check authorization\n    if ($user['id'] !== $id &amp;&amp; !$user['is_admin']) {\n        return new Response(403, [], json_encode(['error' =&gt; 'Forbidden']));\n    }\n\n    // Update user\n    $data = json_decode($request-&gt;getBody(), true);\n    $this-&gt;userRepo-&gt;update($id, $data);\n\n    return new Response(200, [], json_encode(['message' =&gt; 'Updated']));\n}\n</code></pre>"},{"location":"guides/authentication/#role-based-access-control-rbac","title":"Role-Based Access Control (RBAC)","text":""},{"location":"guides/authentication/#user-roles","title":"User Roles","text":"<pre><code>class UserRepository extends AbstractRepository\n{\n    public function findWithRoles(int $userId): array\n    {\n        $user = $this-&gt;findById($userId);\n\n        $stmt = $this-&gt;connection-&gt;prepare('\n            SELECT r.name FROM roles r\n            INNER JOIN user_roles ur ON ur.role_id = r.id\n            WHERE ur.user_id = ?\n        ');\n        $stmt-&gt;execute([$userId]);\n\n        $user['roles'] = array_column($stmt-&gt;fetchAll(\\PDO::FETCH_ASSOC), 'name');\n\n        return $user;\n    }\n\n    public function hasRole(int $userId, string $role): bool\n    {\n        $stmt = $this-&gt;connection-&gt;prepare('\n            SELECT COUNT(*) FROM user_roles ur\n            INNER JOIN roles r ON r.id = ur.role_id\n            WHERE ur.user_id = ? AND r.name = ?\n        ');\n        $stmt-&gt;execute([$userId, $role]);\n\n        return (int) $stmt-&gt;fetchColumn() &gt; 0;\n    }\n}\n</code></pre>"},{"location":"guides/authentication/#authorization-helper","title":"Authorization Helper","text":"<pre><code>class AuthorizationService\n{\n    public function __construct(\n        private UserRepository $userRepo\n    ) {}\n\n    public function can(int $userId, string $permission): bool\n    {\n        $stmt = $this-&gt;connection-&gt;prepare('\n            SELECT COUNT(*) FROM permissions p\n            INNER JOIN role_permissions rp ON rp.permission_id = p.id\n            INNER JOIN user_roles ur ON ur.role_id = rp.role_id\n            WHERE ur.user_id = ? AND p.name = ?\n        ');\n        $stmt-&gt;execute([$userId, $permission]);\n\n        return (int) $stmt-&gt;fetchColumn() &gt; 0;\n    }\n}\n</code></pre>"},{"location":"guides/authentication/#session-based-authentication","title":"Session-Based Authentication","text":""},{"location":"guides/authentication/#session-service","title":"Session Service","text":"<pre><code>class SessionService\n{\n    public function start(): void\n    {\n        if (session_status() === PHP_SESSION_NONE) {\n            session_start();\n        }\n    }\n\n    public function set(string $key, mixed $value): void\n    {\n        $_SESSION[$key] = $value;\n    }\n\n    public function get(string $key, mixed $default = null): mixed\n    {\n        return $_SESSION[$key] ?? $default;\n    }\n\n    public function has(string $key): bool\n    {\n        return isset($_SESSION[$key]);\n    }\n\n    public function remove(string $key): void\n    {\n        unset($_SESSION[$key]);\n    }\n\n    public function destroy(): void\n    {\n        session_destroy();\n    }\n}\n</code></pre>"},{"location":"guides/authentication/#complete-example","title":"Complete Example","text":"<pre><code>&lt;?php\n// Register services in bootstrap.php\n\n$container-&gt;set(JwtService::class, function() {\n    return new JwtService(getenv('JWT_SECRET'));\n});\n\n$container-&gt;set(AuthService::class, function(Container $c) {\n    return new AuthService(\n        $c-&gt;get(UserRepository::class),\n        $c-&gt;get(JwtService::class)\n    );\n});\n\n// Usage in client\n// POST /auth/register\n{\n    \"name\": \"Alice\",\n    \"email\": \"alice@example.com\",\n    \"password\": \"secret123\"\n}\n\n// POST /auth/login\n{\n    \"email\": \"alice@example.com\",\n    \"password\": \"secret123\"\n}\n// Response: { \"token\": \"eyJ0eXAiOiJKV1QiLCJhbGc...\" }\n\n// GET /auth/me\n// Headers: Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGc...\n// Response: { \"id\": 1, \"name\": \"Alice\", \"email\": \"alice@example.com\" }\n</code></pre>"},{"location":"guides/cli-usage/","title":"CLI Usage","text":"<p>The Tusk CLI provides commands for scaffolding and running applications.</p>"},{"location":"guides/cli-usage/#commands","title":"Commands","text":""},{"location":"guides/cli-usage/#init-create-new-project","title":"<code>init</code> - Create New Project","text":"<pre><code>tusk init &lt;name&gt; [--type=api|micro]\n</code></pre> <p>Arguments: - <code>name</code> - Project name (required)</p> <p>Options: - <code>--type</code> - Project type: <code>api</code> (default) or <code>micro</code></p> <p>Example:</p> <pre><code>tusk init my-api\ncd my-api\ncomposer install\n</code></pre>"},{"location":"guides/cli-usage/#start-boot-the-runtime","title":"<code>start</code> - Boot the Runtime","text":"<pre><code>tusk start [--port=8080] [--workers=4]\n</code></pre> <p>Options: - <code>--port</code> - HTTP port to listen on (overrides <code>tusk.json</code>) - <code>--workers</code> - Number of concurrent PHP workers (overrides <code>tusk.json</code>)</p> <p>Example:</p> <pre><code>tusk start\n</code></pre>"},{"location":"guides/cli-usage/#setup-verify-environment","title":"<code>setup</code> - Verify Environment","text":"<pre><code>tusk setup\n</code></pre> <p>Checks project structure, PHP availability, and configuration validity.</p>"},{"location":"guides/cli-usage/#script-proxying-npm-style","title":"Script Proxying (npm-style)","text":"<p>Tusk can execute custom scripts defined in your <code>tusk.json</code>:</p> <pre><code>\"scripts\": {\n    \"test\": \"phpunit\",\n    \"db:migrate\": \"tusk migrate\"\n}\n</code></pre> <p>Run them via:</p> <pre><code>tusk test\ntusk db:migrate\n</code></pre>"},{"location":"guides/cli-usage/#development-workflow","title":"Development Workflow","text":"<ol> <li>Scaffold: <code>tusk init my-app</code></li> <li>Develop: Edit controllers, services</li> <li>Test: <code>tusk run public/index.php</code></li> <li>Deploy: Use Docker Compose or native server</li> </ol>"},{"location":"guides/cli-usage/#tips","title":"Tips","text":"<ul> <li>Use <code>--type=micro</code> for microservice projects (includes health checks)</li> <li>The generated <code>docker-compose.yml</code> includes MySQL by default</li> <li>Edit <code>composer.json</code> to add dependencies</li> </ul>"},{"location":"guides/deployment/","title":"Deployment","text":"<p>Guide for deploying Tusk applications to production.</p>"},{"location":"guides/deployment/#docker","title":"Docker","text":"<p>Use the generated <code>docker-compose.yml</code>:</p> <pre><code>docker-compose up -d\n</code></pre>"},{"location":"guides/deployment/#native-server","title":"Native Server","text":"<p>Run the Tusk native server:</p> <pre><code>php tusk.phar run public/index.php\n</code></pre> <p>For production, use a process manager like systemd or supervisord.</p>"},{"location":"guides/deployment/#nginx-proxy-optional","title":"Nginx Proxy (Optional)","text":"<pre><code>server {\n    listen 80;\n    server_name example.com;\n\n    location / {\n        proxy_pass http://127.0.0.1:8080;\n        proxy_set_header Host $host;\n    }\n}\n</code></pre>"},{"location":"guides/deployment/#environment-variables","title":"Environment Variables","text":"<p>Configure via <code>.env</code>:</p> <pre><code>APP_ENV=production\nDB_CONNECTION=mysql://user:pass@db:3306/app\n</code></pre> <p>Full deployment guide coming soon.</p>"},{"location":"guides/testing/","title":"Testing Guide","text":"<p>Learn how to test your Tusk applications effectively.</p>"},{"location":"guides/testing/#unit-testing","title":"Unit Testing","text":""},{"location":"guides/testing/#testing-controllers","title":"Testing Controllers","text":"<pre><code>use PHPUnit\\Framework\\TestCase;\nuse Tusk\\Web\\Http\\Request;\nuse App\\Controller\\UserController;\n\nclass UserControllerTest extends TestCase\n{\n    private UserController $controller;\n    private UserRepository $mockRepo;\n\n    protected function setUp(): void\n    {\n        $this-&gt;mockRepo = $this-&gt;createMock(UserRepository::class);\n        $this-&gt;controller = new UserController($this-&gt;mockRepo);\n    }\n\n    public function testListUsers(): void\n    {\n        // Arrange\n        $this-&gt;mockRepo\n            -&gt;expects($this-&gt;once())\n            -&gt;method('findAll')\n            -&gt;willReturn([\n                ['id' =&gt; 1, 'name' =&gt; 'Alice'],\n                ['id' =&gt; 2, 'name' =&gt; 'Bob'],\n            ]);\n\n        $request = new Request('GET', '/users', [], [], '');\n\n        // Act\n        $response = $this-&gt;controller-&gt;list($request);\n\n        // Assert\n        $this-&gt;assertEquals(200, $response-&gt;getStatusCode());\n        $data = json_decode($response-&gt;getBody(), true);\n        $this-&gt;assertCount(2, $data);\n    }\n\n    public function testShowUser(): void\n    {\n        // Arrange\n        $this-&gt;mockRepo\n            -&gt;expects($this-&gt;once())\n            -&gt;method('findById')\n            -&gt;with(1)\n            -&gt;willReturn(['id' =&gt; 1, 'name' =&gt; 'Alice']);\n\n        $request = new Request('GET', '/users/1', [], [], '');\n\n        // Act\n        $response = $this-&gt;controller-&gt;show($request, 1);\n\n        // Assert\n        $this-&gt;assertEquals(200, $response-&gt;getStatusCode());\n    }\n}\n</code></pre>"},{"location":"guides/testing/#testing-repositories","title":"Testing Repositories","text":"<pre><code>use PHPUnit\\Framework\\TestCase;\nuse Tusk\\Data\\Driver\\ConnectionInterface;\nuse App\\Repository\\UserRepository;\n\nclass UserRepositoryTest extends TestCase\n{\n    private UserRepository $repo;\n    private ConnectionInterface $mockConnection;\n\n    protected function setUp(): void\n    {\n        $this-&gt;mockConnection = $this-&gt;createMock(ConnectionInterface::class);\n        $this-&gt;repo = new UserRepository($this-&gt;mockConnection);\n    }\n\n    public function testFindById(): void\n    {\n        // Arrange\n        $mockStmt = $this-&gt;createMock(\\PDOStatement::class);\n        $mockStmt-&gt;expects($this-&gt;once())\n            -&gt;method('execute')\n            -&gt;with([1]);\n        $mockStmt-&gt;expects($this-&gt;once())\n            -&gt;method('fetch')\n            -&gt;willReturn(['id' =&gt; 1, 'name' =&gt; 'Alice']);\n\n        $this-&gt;mockConnection\n            -&gt;expects($this-&gt;once())\n            -&gt;method('prepare')\n            -&gt;with('SELECT * FROM users WHERE id = ?')\n            -&gt;willReturn($mockStmt);\n\n        // Act\n        $user = $this-&gt;repo-&gt;findById(1);\n\n        // Assert\n        $this-&gt;assertEquals(1, $user['id']);\n        $this-&gt;assertEquals('Alice', $user['name']);\n    }\n}\n</code></pre>"},{"location":"guides/testing/#integration-testing","title":"Integration Testing","text":""},{"location":"guides/testing/#database-testing","title":"Database Testing","text":"<pre><code>use PHPUnit\\Framework\\TestCase;\nuse Tusk\\Data\\Driver\\Pdo\\PdoConnection;\nuse App\\Repository\\UserRepository;\n\nclass UserRepositoryIntegrationTest extends TestCase\n{\n    private PdoConnection $connection;\n    private UserRepository $repo;\n\n    protected function setUp(): void\n    {\n        // Use SQLite in-memory database for testing\n        $this-&gt;connection = new PdoConnection('sqlite::memory:');\n\n        // Create schema\n        $this-&gt;connection-&gt;exec('\n            CREATE TABLE users (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                name TEXT NOT NULL,\n                email TEXT UNIQUE NOT NULL\n            )\n        ');\n\n        $this-&gt;repo = new UserRepository($this-&gt;connection);\n    }\n\n    public function testCreateAndFind(): void\n    {\n        // Create user\n        $id = $this-&gt;repo-&gt;create([\n            'name' =&gt; 'Alice',\n            'email' =&gt; 'alice@example.com'\n        ]);\n\n        // Find user\n        $user = $this-&gt;repo-&gt;findById($id);\n\n        $this-&gt;assertEquals('Alice', $user['name']);\n        $this-&gt;assertEquals('alice@example.com', $user['email']);\n    }\n\n    public function testUpdate(): void\n    {\n        $id = $this-&gt;repo-&gt;create([\n            'name' =&gt; 'Alice',\n            'email' =&gt; 'alice@example.com'\n        ]);\n\n        $this-&gt;repo-&gt;update($id, [\n            'name' =&gt; 'Alice Smith',\n            'email' =&gt; 'alice.smith@example.com'\n        ]);\n\n        $user = $this-&gt;repo-&gt;findById($id);\n        $this-&gt;assertEquals('Alice Smith', $user['name']);\n    }\n}\n</code></pre>"},{"location":"guides/testing/#http-testing","title":"HTTP Testing","text":""},{"location":"guides/testing/#testing-routes","title":"Testing Routes","text":"<pre><code>use PHPUnit\\Framework\\TestCase;\nuse Tusk\\Web\\Router\\Router;\nuse Tusk\\Web\\Http\\Request;\nuse Tusk\\Core\\Container\\Container;\n\nclass RouterTest extends TestCase\n{\n    private Router $router;\n\n    protected function setUp(): void\n    {\n        $container = new Container();\n        $this-&gt;router = new Router($container);\n        $this-&gt;router-&gt;registerControllers([\n            \\App\\Controller\\UserController::class,\n        ]);\n    }\n\n    public function testGetUsers(): void\n    {\n        $request = new Request('GET', '/users', [], [], '');\n        $response = $this-&gt;router-&gt;dispatch($request);\n\n        $this-&gt;assertEquals(200, $response-&gt;getStatusCode());\n    }\n\n    public function testPostUser(): void\n    {\n        $request = new Request('POST', '/users', \n            ['Content-Type' =&gt; 'application/json'],\n            [],\n            json_encode(['name' =&gt; 'Alice', 'email' =&gt; 'alice@example.com'])\n        );\n\n        $response = $this-&gt;router-&gt;dispatch($request);\n\n        $this-&gt;assertEquals(201, $response-&gt;getStatusCode());\n    }\n\n    public function test404NotFound(): void\n    {\n        $this-&gt;expectException(\\Tusk\\Web\\Exception\\RouteNotFoundException::class);\n\n        $request = new Request('GET', '/nonexistent', [], [], '');\n        $this-&gt;router-&gt;dispatch($request);\n    }\n}\n</code></pre>"},{"location":"guides/testing/#test-fixtures","title":"Test Fixtures","text":""},{"location":"guides/testing/#database-fixtures","title":"Database Fixtures","text":"<pre><code>class DatabaseFixtures\n{\n    public static function loadUsers(ConnectionInterface $connection): void\n    {\n        $users = [\n            ['name' =&gt; 'Alice', 'email' =&gt; 'alice@example.com'],\n            ['name' =&gt; 'Bob', 'email' =&gt; 'bob@example.com'],\n            ['name' =&gt; 'Charlie', 'email' =&gt; 'charlie@example.com'],\n        ];\n\n        $stmt = $connection-&gt;prepare('\n            INSERT INTO users (name, email) VALUES (?, ?)\n        ');\n\n        foreach ($users as $user) {\n            $stmt-&gt;execute([$user['name'], $user['email']]);\n        }\n    }\n}\n\n// Usage in tests\nprotected function setUp(): void\n{\n    parent::setUp();\n    DatabaseFixtures::loadUsers($this-&gt;connection);\n}\n</code></pre>"},{"location":"guides/testing/#test-configuration","title":"Test Configuration","text":""},{"location":"guides/testing/#phpunit-configuration","title":"PHPUnit Configuration","text":"<pre><code>&lt;!-- phpunit.xml --&gt;\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;phpunit bootstrap=\"vendor/autoload.php\"\n         colors=\"true\"\n         verbose=\"true\"&gt;\n    &lt;testsuites&gt;\n        &lt;testsuite name=\"Unit\"&gt;\n            &lt;directory&gt;tests/Unit&lt;/directory&gt;\n        &lt;/testsuite&gt;\n        &lt;testsuite name=\"Integration\"&gt;\n            &lt;directory&gt;tests/Integration&lt;/directory&gt;\n        &lt;/testsuite&gt;\n    &lt;/testsuites&gt;\n\n    &lt;coverage&gt;\n        &lt;include&gt;\n            &lt;directory suffix=\".php\"&gt;src&lt;/directory&gt;\n        &lt;/include&gt;\n    &lt;/coverage&gt;\n&lt;/phpunit&gt;\n</code></pre>"},{"location":"guides/testing/#running-tests","title":"Running Tests","text":"<pre><code># Run all tests\n./vendor/bin/phpunit\n\n# Run specific suite\n./vendor/bin/phpunit --testsuite Unit\n\n# Run with coverage\n./vendor/bin/phpunit --coverage-html coverage/\n</code></pre>"},{"location":"guides/testing/#best-practices","title":"Best Practices","text":"<ol> <li>Test Isolation - Each test should be independent</li> <li>Mock External Dependencies - Don't hit real databases/APIs in unit tests</li> <li>Use In-Memory Databases - SQLite for integration tests</li> <li>Descriptive Test Names - <code>testCreateUserWithValidData()</code></li> <li>Arrange-Act-Assert - Structure tests clearly</li> <li>Test Edge Cases - Not just happy paths</li> <li>Keep Tests Fast - Unit tests should run in milliseconds</li> </ol>"}]}